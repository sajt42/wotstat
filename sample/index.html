<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hearts in Bloom â€“ Community Progress</title>
  <style>
    :root {
      --bg: #111;
      --fg: #eee;
      --accent1: #ff4b8b;
      --accent2: #ffb347;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--fg);
    }
    .wrapper {
      width: 90%;
      max-width: 800px;
      text-align: center;
    }

    .logo {
      margin-bottom: 10px;
    }
    .logo img {
      max-width: 240px;
      height: auto;
      opacity: 0.95;
    }

    h1 {
      margin: 0 0 30px 0;
      font-size: 32px;
      letter-spacing: 1px;
    }
    #progress-container {
      width: 100%;
      margin: 0 auto 25px auto;
      border: 1px solid #555;
      border-radius: 8px;
      background: #222;
      overflow: hidden;
    }
    #progress-bar {
      height: 40px;
      width: 0%;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      transition: width 0.5s ease;
    }
    #numbers {
      margin-top: 20px;
      line-height: 1.3;
    }
    #current-total {
      font-size: 40px;
      font-weight: 700;
    }
    #percent {
      font-size: 32px;
      font-weight: 600;
      color: var(--accent2);
    }
    #status {
      margin-top: 15px;
      font-size: 12px;
      color: #aaa;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="logo">
      <img src="wotr_logo.jpg" alt="World of Trucks logo">
    </div>


    <div class="global-event-title" style="display:none;">Hearts in Bloom Progress</div>
    <h1 id="event-title"></h1>

    <div id="progress-container">
      <div id="progress-bar"></div>
    </div>

    <div id="numbers">
      <div id="current-total">Loading...</div>
      <div id="percent"></div>
    </div>

    <div id="status"></div>
  </div>

  <script>
    // Set event title from .global-event-title
    (function() {
      var eventDiv = document.querySelector('.global-event-title');
      var h1 = document.getElementById('event-title');
      if (eventDiv && h1) {
        h1.textContent = eventDiv.textContent;
      }
    })();
    const API_URL = "http://localhost:8000/progress";
    const REFRESH_MS = 15000;

    async function fetchProgress() {
      const statusEl = document.getElementById('status');
      const curTotEl = document.getElementById('current-total');
      const percentEl = document.getElementById('percent');
      const barEl = document.getElementById('progress-bar');

      statusEl.textContent = 'Updating...';

      try {
        const resp = await fetch(API_URL);
        const data = await resp.json();

        if (!data.success) {
          statusEl.textContent = 'Error: ' + (data.error || 'unknown error');
          return;
        }

        const current = data.current;
        const total = data.total;
        const percent = data.percent;

        barEl.style.width = percent.toFixed(2) + '%';

        curTotEl.textContent =
          current.toLocaleString('en-US') +
          ' / ' +
          total.toLocaleString('en-US');

        percentEl.textContent = percent.toFixed(2) + ' %';

        statusEl.textContent =
          'Last update: ' + new Date().toLocaleTimeString();

      } catch (err) {
        console.error(err);
        statusEl.textContent =
          'An error occurred while fetching data (check if the API is available).';
      }
    }

    fetchProgress();
    setInterval(fetchProgress, REFRESH_MS);
  </script>
</body>
</html>
